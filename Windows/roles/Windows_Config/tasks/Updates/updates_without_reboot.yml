- name: INFORMATION
  debug:
      msg: "Starting to update..."

#-----------------------------#DIRECTORY-UPDATES-SEARCH#-----------------------------#
- name: Create directory Updates structure
  ansible.windows.win_file:
    path: C:\Updates
    state: directory
#-----------------------------#DIRECTORY-UPDATES-SEARCH#-----------------------------#

#-----------------------------#UPDATES-SEARCH#-----------------------------#
- name: Search-only, return list of found updates (if any), log to C:\Updates\latest_updates_result.txt
  ansible.windows.win_updates:
    state: searched
    log_path: C:\Updates\latest_updates_result.txt
  register: list_found_updates.stdout_lines

- name: Show list of found updates
  debug:
      var: list_found_updates.stdout_lines
#-----------------------------#UPDATES-SEARCH#-----------------------------#

- name: Create a shortcut of the document on the desktop
  community.windows.win_shortcut:
    directory: C:\Updates
    src: latest_updates_result.txt
    dest: Desktop\latest_updates_result.txt
    state: present

#-----------------------------#UPDATES-INSTALLATION#-----------------------------#
- name: Install all updates
  ansible.windows.win_updates:
    category_names: '*'
    reboot: false
  register: installation_updates

- name: Show result of installation
  debug:
      var: installation_updates
#-----------------------------#UPDATES-INSTALLATION#-----------------------------#
